{% block content %}

<style>
.table-wrapper {
  background: #fff;
  padding: 16px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
}

.table-supplier {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.table-supplier th {
  background: #2c3e50;
  color: white;
  padding: 10px;
}

.table-supplier td {
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.table-supplier tr:hover {
  background: #f4f6f8;
}

.badge {
  background: #3498db;
  color: white;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.nonaktif {
  background: #f1f1f1;
  color: #888;
}

/* SWITCH */
.switch {
  position: relative;
  display: inline-block;
  width: 42px;
  height: 22px;
}
.switch input { display: none; }

.slider {
  position: absolute;
  cursor: pointer;
  background-color: #ccc;
  border-radius: 34px;
  top: 0; left: 0; right: 0; bottom: 0;
  transition: .3s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: .3s;
}

input:checked + .slider {
  background-color: #2ecc71;
}

input:checked + .slider:before {
  transform: translateX(20px);
}

.empty {
  text-align: center;
  padding: 20px;
  color: #888;
}
</style>

<h2>üì¶ Data Supplier</h2>
<div id="supplierSummary" style="margin-bottom:12px;font-size:14px;">
  Total: <b id="totalSupplier">0</b> |
  Aktif: <b style="color:#2ecc71" id="totalAktif">0</b> |
  Non Aktif: <b style="color:#e74c3c" id="totalNonaktif">0</b>
</div>
<div style="margin-bottom:12px;">
  <input
    type="text"
    id="searchSupplier"
    placeholder="Cari supplier..."
    style="padding:8px 12px;width:100%;max-width:300px;border-radius:6px;border:1px solid #ccc;font-size:14px;"
  >
</div>
<div class="table-wrapper">
<table class="table-supplier">
  <thead>
    <tr>
      <th>No</th>
      <th>ID</th>
      <th>Nama Supplier</th>
      <th>Alamat</th>
      <th>Telp</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    {% if data %}
      {% for s in data %}
      <tr class="{% if s.status == 0 %}nonaktif{% endif %}">
        <td>{{ loop.index }}</td>
        <td><span class="badge">{{ s.id_supplier }}</span></td>
        <td>{{ s.nama_supplier }}</td>
        <td>{{ s.alamat or '-' }}</td>
        <td>{{ s.telp or '-' }}</td>


<td>
  {% if s.status == 1 %}
    <a href="/supplier/toggle/{{ s.id_supplier }}/0" class="link-status"
       data-id="{{ s.id_supplier }}" data-status="1"
       onclick="return toggleStatus(event, this)"
       style="color:#2ecc71;font-weight:bold;text-decoration:none;cursor:pointer">
       ‚óè Aktif
    </a>
  {% else %}
    <a href="/supplier/toggle/{{ s.id_supplier }}/1" class="link-status"
       data-id="{{ s.id_supplier }}" data-status="0"
       onclick="return toggleStatus(event, this)"
       style="color:#e74c3c;font-weight:bold;text-decoration:none;cursor:pointer">
      ‚óè Non Aktif
    </a>
  {% endif %}
</td>



      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="6" class="empty">‚ùå Data supplier belum ada</td>
      </tr>
    {% endif %}
  </tbody>
</table>
</div>

<script>
function toggleStatus(ev, el) {
  ev.preventDefault();
  var id = el.getAttribute("data-id");
  var currentStatus = parseInt(el.getAttribute("data-status"), 10);
  var newStatus = currentStatus === 1 ? 0 : 1;
  var url = "/supplier/toggle/" + id + "/" + newStatus;

  fetch(url)
    .then(function(res) {
      if (!res.ok) throw new Error("Gagal update status");
      // Update tampilan langsung tanpa reload
      el.setAttribute("data-status", String(newStatus));
      el.href = "/supplier/toggle/" + id + "/" + (newStatus === 1 ? 0 : 1);
      if (newStatus === 1) {
        el.textContent = "‚óè Aktif";
        el.style.color = "#2ecc71";
      } else {
        el.textContent = "‚óè Non Aktif";
        el.style.color = "#e74c3c";
      }
      el.closest("tr").classList.toggle("nonaktif", newStatus === 0);
    })
    .catch(function() {
      alert("Koneksi server error. Coba lagi.");
    });
  return false;
}

</script>
<script>
(function initSupplierSearch() {
  const input = document.getElementById("searchSupplier");
  const tbody = document.querySelector(".table-supplier tbody");

  if (!input || !tbody) return;

  input.addEventListener("input", function () {
    const keyword = this.value.toLowerCase().trim();
    const rows = tbody.querySelectorAll("tr");
    let hasVisible = false;

    rows.forEach(row => {
      // Skip row "data belum ada"
      if (row.querySelector(".empty")) return;

      const text = row.innerText.toLowerCase();
      const match = text.includes(keyword);

      row.style.display = match ? "" : "none";
      if (match) hasVisible = true;
    });

    // pesan kosong
    let emptyRow = tbody.querySelector(".empty-search");
    if (!hasVisible && rows.length > 0) {
      if (!emptyRow) {
        emptyRow = document.createElement("tr");
        emptyRow.className = "empty-search";
        emptyRow.innerHTML = `<td colspan="6" class="empty">‚ùå Data tidak ditemukan</td>`;
        tbody.appendChild(emptyRow);
      }
    } else if (emptyRow) {
      emptyRow.remove();
    }
  });
})();
</script>
<script>
(function initSupplierSummary() {

  function updateSupplierSummary() {
    const rows = document.querySelectorAll(".table-supplier tbody tr");
    let total = 0, aktif = 0, nonaktif = 0;

    rows.forEach(row => {
      // abaikan row "data belum ada"
      if (row.querySelector(".empty")) return;

      total++;
      if (row.classList.contains("nonaktif")) {
        nonaktif++;
      } else {
        aktif++;
      }
    });

    document.getElementById("totalSupplier").innerText = total;
    document.getElementById("totalAktif").innerText = aktif;
    document.getElementById("totalNonaktif").innerText = nonaktif;
  }

  // üî• HITUNG LANGSUNG SAAT HALAMAN DIBUKA
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", updateSupplierSummary);
  } else {
    updateSupplierSummary();
  }

  // üîÅ update setelah toggle status
  const originalToggle = toggleStatus;
  window.toggleStatus = function(ev, el) {
    originalToggle(ev, el);
    setTimeout(updateSupplierSummary, 150);
  };

  // üîç update saat search (kalau search ada)
  const searchInput = document.getElementById("searchSupplier");
  if (searchInput) {
    searchInput.addEventListener("input", updateSupplierSummary);
  }

})();
</script>

{% endblock %}
