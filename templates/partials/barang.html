{% block content %}

<style>
.table-wrapper {
  background:#fff;
  padding:16px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.table-barang {
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

.table-barang th {
  background:#2c3e50;
  color:#fff;
  padding:10px;
}

.table-barang td {
  padding:10px;
  border-bottom:1px solid #eee;
}

.table-barang tr:hover {
  background:#f4f6f8;
}

/* ===== STATUS WARNA ===== */
.supplier-nonaktif {
  background:#f2f2f2 !important;
  color:#999;
}

.supplier-nonaktif .badge {
  background:#bdbdbd;
}

.stok-habis {
  color:#e74c3c;
  font-weight:bold;
}

.stok-warning {
  color:#f39c12;
  font-weight:bold;
}

/* badge */
.badge {
  background:#3498db;
  color:#fff;
  padding:3px 8px;
  border-radius:4px;
  font-size:12px;
}

.empty {
  text-align:center;
  padding:20px;
  color:#888;
}

/* filter */
.filter-bar {
  display:flex;
  gap:10px;
  margin-bottom:12px;
}

.filter-bar input,
.filter-bar select {
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

/* modal */
.form-overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.form-detail {
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:380px;
}

.form-detail label {
  margin-top:10px;
  display:block;
  font-size:14px;
}

.form-detail input,
.form-detail textarea {
  width:95%;
  padding:8px;
  margin-top:4px;
  border-radius:6px;
  border:1px solid #ccc;
}

.form-detail input[readonly],
.form-detail textarea[readonly] {
  background:#f5f6f7;
}

.cancel-btn {
  background:#e74c3c;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}
.form-detail input[readonly],
.form-detail textarea[readonly],
.form-detail select:disabled {
  background: #f5f6f7;
  color: #555;
  cursor: not-allowed;
}
</style>

<h2>üì¶ Data Barang</h2>

<div class="filter-bar">
  <select id="supplierFilter">
    <option value="">Semua Supplier</option>
    {% for s in suppliers %}
      <option value="{{ s.nama_supplier }}">{{ s.nama_supplier }}</option>
    {% endfor %}
  </select>

  <input type="text" id="searchInput" placeholder="Cari barang...">
</div>

<div class="table-wrapper">
<table class="table-barang">
<thead>
<tr>
  <th>No</th>
  <th>Nama Barang</th>
  <th>Stok</th>
  <th>Satuan</th>
  <th>Supplier</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="barangBody">
{% if data %}
{% for b in data %}
<tr
  class="row-barang 
    {% if b.status_supplier == 0 %}supplier-nonaktif{% endif %}"
  data-nama="{{ b.nama_barang | lower }}"
  data-supplier="{{ b.nama_supplier | lower }}"
  data-stok="{{ b.stok }}"
  data-satuan="{{ b.satuan }}"
  data-spek="{{ b.spek or '-' }}"
>
  <td>{{ loop.index }}</td>
  <td>{{ b.nama_barang }}</td>
<td class="
  {% if b.stok == 0 %}stok-habis
  {% elif b.stok < 10 %}stok-warning
  {% endif %}
">
  {{ b.stok }}
</td>

<td>
  <span class="badge">{{ b.satuan }}</span>
</td>
  <td>
    <span class="badge">{{ b.nama_supplier }}</span>
    {% if b.status_supplier == 0 %}
      <small>(Non Aktif)</small>
    {% endif %}
  </td>
  <td>
    <button class="btn-detail">Detail</button>
  </td>
</tr>
{% endfor %}
{% else %}
<tr>
  <td colspan="5" class="empty">‚ùå Data barang belum ada</td>
</tr>
{% endif %}
</tbody>
</table>
</div>

<!-- MODAL DETAIL -->
<div class="form-overlay" id="formOverlay">
<div class="form-detail">
  <h4>Detail Barang</h4>

  <label>Nama Barang</label>
  <input id="formNama" readonly>

  <label>Stok</label>
  <input id="formStok" readonly>
 
  <label>Satuan</label>
  <input id="formSatuan" readonly>

  <label>Spesifikasi</label>
  <textarea id="formSpek" readonly></textarea>

  <label>Supplier</label>
  <input id="formSupplier" readonly>

  <div style="text-align:right;margin-top:12px;">
    <button class="cancel-btn" id="formCancel">Tutup</button>
  </div>
</div>
</div>

<script>
(function(){
  const search = document.getElementById("searchInput");
  const filter = document.getElementById("supplierFilter");
  const rows = document.querySelectorAll(".row-barang");
  const overlay = document.getElementById("formOverlay");

  function applyFilter(){
    const s = search.value.toLowerCase();
    const f = filter.value.toLowerCase();

    rows.forEach(r=>{
      const ok =
        r.dataset.nama.includes(s) &&
        (f==="" || r.dataset.supplier===f);
      r.style.display = ok ? "" : "none";
    });
  }

  search.oninput = applyFilter;
  filter.onchange = applyFilter;

  document.querySelectorAll(".btn-detail").forEach(btn=>{
    btn.onclick = ()=>{
      const r = btn.closest("tr");
      formNama.value = r.children[1].innerText;
      formStok.value = r.dataset.stok;
      formSatuan.value = r.dataset.satuan;
      formSpek.value = r.dataset.spek;
      formSupplier.value = r.children[4].innerText;
      overlay.style.display="flex";
    };
  });

  formCancel.onclick = ()=> overlay.style.display="none";
  overlay.onclick = e => e.target===overlay && (overlay.style.display="none");
})();
</script>

{% endblock %}
